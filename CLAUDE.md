# CLAUDE.md — DEC DASH 2.0

## Project Overview

Executive dashboard for the Dads' Education Center (DEC) nonprofit. Next.js 15 + Convex backend.

## Commands

- `npm run dev` — Start Next.js dev server
- `npx convex dev` — Start Convex backend (watch mode, deploys on save)
- `npx convex dev --once` — Deploy Convex once without watching
- `npm run build` — Production build
- `npm run lint` — Run ESLint

## Architecture

### Backend (Convex)

- Schema defined in `convex/schema.ts`
- `_generated/` folder is auto-generated by `npx convex dev` — don't edit
- Actions using npm packages (`intuit-oauth`, `googleapis`, `openai`) need `"use node"` runtime directive
- Auth: `@convex-dev/auth` with Password provider
- RBAC: `requireRole()` helper in `convex/users.ts` — roles are `admin`, `manager`, `staff`, `readonly`
- QB/Sheets data cached in Convex tables, synced via crons (QB: 15min, Sheets: 30min)
- OAuth configs (`quickbooksConfig`, `constantContactConfig`) are global singletons queried with `.first()`

### Frontend (Next.js)

- App Router with `(dashboard)` route group for authenticated pages
- Tailwind CSS v4 — uses `@theme` inline block, not `tailwind.config.js`
- Theme colors: `--primary: #1B4D3E` (green), `--accent: #D4A843` (gold)
- Charts use `react-chartjs-2` / `chart.js`

## Key Patterns

- Convex queries/mutations are called via `useQuery`/`useMutation` from `convex/react`
- OAuth callbacks are Next.js API routes at `src/app/api/{provider}/callback/route.ts`
- OAuth callbacks use `ConvexHttpClient` (not React hooks) since they run server-side
- `intuit-oauth` has no `@types` package — custom type declarations at `src/types/intuit-oauth.d.ts`

## Gotchas

- Directory name has a space ("DEC-DASH 2.0") — always quote paths in shell commands
- `npx convex init` is deprecated — use `npx convex dev --once --configure=new`
- Convex `_generated/api.d.ts` changes frequently — commit it when schema changes
